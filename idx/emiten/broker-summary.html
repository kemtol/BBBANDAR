<!DOCTYPE html>
<html lang="id">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="theme-color" content="#0b0b0e" />

    <script>
        (function () {
            const STORAGE_KEY = 'ui:theme';
            const root = document.documentElement;
            try {
                const saved = window.localStorage ? localStorage.getItem(STORAGE_KEY) : null;
                const theme = saved || 'dark';
                root.setAttribute('data-theme', theme);
                root.style.colorScheme = theme === 'dark' ? 'dark' : 'light';
            } catch (error) {
                root.setAttribute('data-theme', 'dark');
                root.style.colorScheme = 'dark';
            }
        })();
    </script>

    <title>SSSAHAM - Intraday Orderflow Scanner</title>

    <link rel="apple-touch-icon" sizes="180x180" href="../img/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="../img/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="../img/favicon-16x16.png">

    <!-- Bootstrap & Font Awesome -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet" />
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.7.2/css/all.min.css" rel="stylesheet" />
    <link rel="stylesheet" href="../../theme.css" />
    <link href="component.css" rel="stylesheet" />

    <style>
        :root {
            --table-header-text: var(--muted);
            --table-hover-bg: #f1f5f9;
            --card-divider: rgba(148, 163, 184, 0.35);
            --card-radius: 12px;
            --legend-foreign: var(--accent-positive);
            --legend-retail: var(--accent-negative);
            --legend-local: var(--accent-info);
            --legend-institution: rgba(25, 135, 84, 0.6);
            --legend-retail-fill: rgba(220, 53, 69, 0.6);
            --legend-price: var(--accent-warning);
            --pull-indicator-bg: #f6f8fb;
            --pull-indicator-icon: var(--muted);
            --ai-heading: #1a1a2e;
            --ai-strong: #e67e22;
            --thumb-border: #dee2e6;
        }

        :root[data-theme="dark"] {
            --table-hover-bg: rgba(255, 255, 255, 0.05);
            --card-divider: rgba(82, 94, 106, 0.55);
            --legend-institution: rgba(78, 203, 113, 0.48);
            --legend-retail-fill: rgba(255, 82, 82, 0.35);
            --legend-price: var(--accent-primary);
            --pull-indicator-bg: var(--surface-alt);
            --pull-indicator-icon: var(--text-secondary);
            --ai-heading: var(--text);
            --ai-strong: var(--accent-primary);
            --thumb-border: #3a3a46;
        }

        body {
            background: var(--bg);
            color: var(--text);
            transition: background-color 0.3s ease, color 0.3s ease;
        }

        body,
        .card,
        .navbar,
        .dropdown-menu,
        .form-control,
        .modal-content {
            transition: background-color 0.3s ease, color 0.3s ease, border-color 0.3s ease;
        }

        .bg-white {
            background-color: var(--surface) !important;
            color: var(--text);
        }

        .text-muted {
            color: var(--text-muted) !important;
        }

        .card {
            background-color: var(--surface);
            border: 1px solid var(--border);
            border-radius: var(--card-radius);
            color: var(--text);
        }

        .card-swing {
            border-radius: var(--card-radius);
            border: 1px solid var(--card-divider);
            box-shadow: none;
            background: transparent !important
        }

        .card-swing-header,
        .card-header {
            background: transparent;
            border-bottom: 1px solid var(--card-divider);
            border-radius: var(--card-radius) var(--card-radius) 0 0;
        }

        .card-body,
        .card-header {
            color: var(--text);
        }

        .table-orderflow {
            font-size: 0.9rem;
            white-space: nowrap;
            color: var(--text);
        }

        .table-orderflow thead th {
            text-transform: uppercase;
            font-size: 0.9rem;
            color: var(--table-header-text);
            border-bottom-color: var(--border);
        }

        .table-orderflow tbody tr {
            cursor: pointer;
        }

        .table-orderflow tbody tr:hover {
            background-color: var(--table-hover-bg);
        }

        .table-orderflow thead th.sortable {
            position: relative;
            padding-right: 14px;
        }

        .sort-icon {
            position: absolute;
            right: 2px;
            top: 50%;
            transform: translateY(-50%);
            color: var(--table-header-text);
        }

        .sort-icon.active {
            opacity: 1;
        }

        .quadrant-badge {
            width: 18px;
            text-align: center;
            border-radius: 999px;
            font-size: 0.7rem;
            display: block;
            height: 18px;
            position: relative;
            left: 5px;
        }

        .stat-pill {
            font-size: 0.7rem;
            border-radius: 999px;
            padding: 2px 8px;
        }

        .quad-legend {
            font-size: 0.7rem;
            color: var(--table-header-text);
        }

        .legend-group {
            font-size: 0.7rem;
        }

        .legend-swatch {
            display: inline-block;
            font-weight: 600;
        }

        .legend-foreign {
            color: var(--legend-foreign);
        }

        .legend-retail {
            color: var(--legend-retail);
        }

        .legend-local {
            color: var(--legend-local);
        }

        .legend-institution {
            color: var(--legend-institution);
        }

        .legend-retail-fill {
            color: var(--legend-retail-fill);
        }

        .legend-price {
            color: var(--legend-price);
        }

        @media (max-width: 767px) {
            .hide-mobile {
                display: none !important;
            }

            .broker-table-mobile {
                font-size: 0.85rem;
            }
        }

        @media (max-width: 576px) {
            .page-title {
                font-size: 0.95rem;
            }
        }

        #pull-indicator {
            position: fixed;
            top: -60px;
            left: 0;
            right: 0;
            height: 60px;
            display: flex;
            align-items: center;
            justify-content: center;
            background: var(--pull-indicator-bg);
            transition: top 0.2s ease-out;
            z-index: 1000;
            color: var(--pull-indicator-icon);
        }

        #pull-indicator.visible {
            top: 0;
        }

        #pull-indicator i {
            font-size: 1.5rem;
            color: var(--pull-indicator-icon);
            transition: transform 0.2s;
        }

        #pull-indicator.ready i {
            transform: rotate(180deg);
        }

        .chart-container-responsive {
            height: 50vh;
            width: 100%;
            position: relative;
        }

        @media (orientation: portrait) {
            .chart-container-responsive {
                height: 30vh !important;
            }
        }

        .nav-title {
            font-size: 0.9rem !important;
        }

        #filter-row button {
            font-size: 0.9rem;
        }

        #active-pills {
            padding: 1rem 0;
        }

        #active-pills .badge {
            font-size: 0.9rem;
        }

        #ai-result-body {
            font-size: 0.9rem;
            line-height: 1.6;
        }

        #ai-result-body h3 {
            font-size: 1rem;
            font-weight: 700;
            margin-top: 1rem;
            color: var(--ai-heading);
        }

        #ai-result-body ul {
            padding-left: 1.2rem;
        }

        #ai-result-body strong {
            color: var(--ai-strong);
        }

        #btn-ai-analyze.analyzing {
            pointer-events: none;
            opacity: 0.7;
        }

        #ai-thumbnails img {
            height: 80px;
            border-radius: 4px;
            border: 1px solid var(--thumb-border);
            cursor: pointer;
            transition: transform 0.15s, box-shadow 0.15s;
            object-fit: cover;
        }

        #ai-thumbnails img:hover {
            transform: scale(1.5);
            z-index: 10;
            box-shadow: var(--shadow-elevated);
        }

        #ai-thumbnails .thumb-label {
            font-size: 0.6rem;
            text-align: center;
            color: var(--table-header-text);
        }

        .navbar {
            box-shadow: none;
        }

        #theme-toggle-icon {
            cursor: pointer;
            color: var(--navbar-text);
            transition: color 0.2s ease;
        }

        #theme-toggle-icon:hover {
            color: var(--navbar-highlight);
        }

        html[data-theme="dark"] .table-orderflow tbody tr:hover {
            color: var(--text);
        }

        html[data-theme="dark"] .dropdown-menu {
            background-color: var(--surface-alt);
            border-color: var(--border);
            color: var(--text);
        }

        html[data-theme="dark"] .dropdown-item:hover {
            background-color: var(--table-hover-bg);
            color: var(--text);
        }

        html[data-theme="dark"] .btn-outline-secondary,
        html[data-theme="dark"] .btn-outline-info {
            color: var(--text);
            border-color: var(--border);
        }

        html[data-theme="dark"] .btn-outline-secondary:hover,
        html[data-theme="dark"] .btn-outline-info:hover {
            background-color: var(--btn-outline-secondary-hover);
            color: var(--text);
        }

        html[data-theme="dark"] .btn-outline-secondary.active,
        html[data-theme="dark"] .btn-outline-secondary:active {
            background-color: var(--primary);
            border-color: var(--primary);
            color: var(--text-inverse);
        }

        html[data-theme="dark"] .btn-outline-info.active,
        html[data-theme="dark"] .btn-outline-info:active {
            background-color: var(--accent-info);
            border-color: var(--accent-info);
            color: var(--text-inverse);
        }

        html[data-theme="dark"] .form-control,
        html[data-theme="dark"] .form-check-input {
            background-color: var(--surface-alt);
            color: var(--text);
            border-color: var(--border);
        }

        html[data-theme="dark"] .form-control::placeholder {
            color: var(--text-muted);
        }

        html[data-theme="dark"] .modal-content {
            background-color: var(--surface);
            color: var(--text);
            border-color: var(--border);
        }

        html[data-theme="dark"] .modal-header,
        html[data-theme="dark"] .modal-footer {
            border-color: var(--border);
        }

        html[data-theme="dark"] .spinner-border.text-primary {
            color: var(--primary) !important;
        }

        html[data-theme="dark"] .pagination .page-link {
            background-color: var(--surface-alt);
            border-color: var(--border);
            color: var(--text);
        }

        html[data-theme="dark"] .pagination .page-item.active .page-link {
            background-color: var(--primary);
            border-color: var(--primary);
            color: var(--text-inverse);
        }

        html[data-theme="dark"] .shadow-sm {
            box-shadow: var(--shadow-elevated) !important;
        }

        html[data-theme="dark"] .bg-light {
            background-color: var(--surface-alt) !important;
            color: var(--text);
        }
    </style>
</head>

<body>
    <!-- Pull to Refresh Indicator -->
    <div id="pull-indicator">
        <i class="fa-solid fa-arrow-down"></i>
        <span class="ms-2 small text-muted" id="pull-text">Tarik untuk refresh</span>
    </div>

    <!-- NAVBAR -->
    <nav class="navbar sticky-top py-3">
        <div class="container d-flex align-items-center justify-content-between" style="max-width: 1440px;position: relative;">
            <div class="d-flex align-items-center gap-3" style="min-width: 140px;">
                <i class="fa-solid fa-circle-half-stroke" id="theme-toggle-icon" title="Toggle theme (Shift + D)"></i>
                <a href="https://buy.sssaham.com" id="nav-back" class="d-flex align-items-center text-decoration-none">
                    <i class="fa-solid fa-chevron-left me-1"></i>
                    <span class="small d-none">Bandar Radar</span>
                </a>
            </div>
            <div class="flex-grow-1 text-center">
                <span class="nav-title" id="header-title">Dashboard</span>
            </div>
            <div style="width:72px;" class="text-end">
                <i class="fa-solid fa-magnifying-glass" style="cursor: pointer;" onclick="toggleSearch()"></i>
            </div>
        </div>
    </nav>

    <div id="search-panel">
        <div class="mb-4">
            <input type="text" id="search-input" class="search-input" placeholder="Masukkan Kode (e.g. BBRI)"
                autocomplete="off">
        </div>

        <div>
            <p class="small opacity-75 mb-2 fw-bold">RIWAYAT PENCARIAN</p>
            <div id="search-history-list">
                <!-- Populated by JS -->
            </div>
        </div>
    </div>

    <div id="loading-indicator" class="text-center my-5">
        <div class="spinner-border text-primary" role="status">
            <span class="visually-hidden">Loading...</span>
        </div>
        <p class="small text-muted mt-2">Memuat data...</p>
    </div>

    <div id="app" class="container mb-3" style="display:none;">

        <!-- VIEW 1: INDEX (DAFTAR EMITEN) -->
        <div id="index-view">
            <!-- DASHBOARD TABS -->
            <ul class="nav nav-tabs mb-3" role="tablist">
                <li class="nav-item" role="presentation">
                    <a class="nav-link" href="../index.html">Feed</a>
                </li>
                <li class="nav-item" role="presentation">
                    <a class="nav-link" href="index.html">Orderflow</a>
                </li>
                <li class="nav-item" role="presentation">
                    <span class="nav-link active">Brokerflow</span>
                </li>
            </ul>
            <!-- FOREIGN SENTIMENT CHART -->
            <div id="foreign-sentiment-widget" class="p-3 mb-3 bg-white rounded-3 shadow-sm">
                <div class="d-flex justify-content-between align-items-center mb-2">
                    <h6 class="text-muted mb-0">Foreign Flow</h6>
                    <div class="btn-group btn-group-sm" id="foreign-range-selector">
                        <a href="#" class="btn btn-outline-secondary btn-sm active" data-days="7">7D</a>
                        <a href="#" class="btn btn-outline-secondary btn-sm" data-days="30">30D</a>
                        <a href="#" class="btn btn-outline-secondary btn-sm" data-days="90">90D</a>
                    </div>
                </div>
                <div id="foreign-chart-loading" class="text-center py-4">
                    <div class="spinner-border text-primary" role="status">
                        <span class="visually-hidden">Loading...</span>
                    </div>
                    <p class="small text-muted mt-2 mb-0">Memuat data foreign flow...</p>
                </div>
                <div class="chart-container-responsive" style="height: 200px; display: none;"
                    id="foreign-chart-container">
                    <canvas id="foreign-sentiment-chart"></canvas>
                </div>
            </div>
            <!-- PRESET BAR -->
            <div class="mb-2 container">
                <!-- Row 1: Presets -->
                <div class="d-flex justify-content-between align-items-center mb-2">
                    <div class="d-flex align-items-center gap-2 flex-wrap">
                        <span class="text-muted fw-bold text-uppercase"
                            style="font-size:0.85rem; letter-spacing:0.5px;width: 75px;">Preset</span>
                        <div class="btn-group btn-group-sm" id="preset-selector">
                            <a href="#" class="btn btn-outline-secondary btn-sm active"
                                style="width: 75px;font-size: 0.9rem;" data-preset="all" title="Tampilkan semua">
                                All
                            </a>
                            <a href="#" class="btn btn-outline-primary btn-sm" style="width: 75px;font-size: 0.9rem;"
                                data-preset="smart" title="Smart Money positif setiap hari">
                                Smart
                            </a>
                            <a href="#" class="btn btn-outline-success btn-sm" style="width: 75px;font-size: 0.9rem;"
                                data-preset="strict" title="Foreign & Smart Money positif setiap hari">
                                Strict
                            </a>
                        </div>
                        <small class="text-muted" id="preset-desc" style="font-size:0.85rem;">Tanpa
                            filter</small>
                    </div>
                    <small class="text-muted" id="screener-count"></small>
                </div>
                <!-- Row 2: Individual Filters -->
                <div class="d-flex align-items-center gap-2 flex-wrap mb-1 pt-2 pb-3" id="filter-row">
                    <span class="text-muted fw-bold text-uppercase"
                        style="font-size:0.85rem; letter-spacing:0.5px;width: 75px;">FILTER</span>
                    <!-- Foreign Net -->
                    <div class="dropdown">
                        <button class="btn btn-sm btn-outline-secondary dropdown-toggle px-2" type="button"
                            data-bs-toggle="dropdown" id="dd-foreign">
                            Foreign: Any
                        </button>
                        <ul class="dropdown-menu dropdown-menu-sm">
                            <li><a class="dropdown-item small" href="#" data-filter="foreign" data-val="any">Any</a>
                            </li>
                            <li><a class="dropdown-item small" href="#" data-filter="foreign" data-val="allPos">Positif
                                    tiap hari</a></li>
                            <li><a class="dropdown-item small" href="#" data-filter="foreign"
                                    data-val="dominant">Kumulatif &gt; 0</a></li>
                        </ul>
                    </div>
                    <!-- Smart Money -->
                    <div class="dropdown">
                        <button class="btn btn-sm btn-outline-secondary dropdown-toggle px-2" type="button"
                            data-bs-toggle="dropdown" id="dd-smart">
                            Smart: Any
                        </button>
                        <ul class="dropdown-menu dropdown-menu-sm">
                            <li><a class="dropdown-item small" href="#" data-filter="smart" data-val="any">Any</a></li>
                            <li><a class="dropdown-item small" href="#" data-filter="smart" data-val="allPos">Positif
                                    tiap hari</a></li>
                            <li><a class="dropdown-item small" href="#" data-filter="smart"
                                    data-val="positive">Kumulatif &gt; 0</a></li>
                        </ul>
                    </div>
                    <!-- Streak -->
                    <div class="dropdown hide-mobile">
                        <button class="btn btn-sm btn-outline-secondary dropdown-toggle px-2" type="button"
                            data-bs-toggle="dropdown" id="dd-streak">
                            Trend: Any
                        </button>
                        <ul class="dropdown-menu dropdown-menu-sm">
                            <li><a class="dropdown-item small" href="#" data-filter="streak" data-val="any">Any</a></li>
                            <li><a class="dropdown-item small" href="#" data-filter="streak" data-val="s3">Streak ≥ 3 hari</a>
                            </li>
                            <li><a class="dropdown-item small" href="#" data-filter="streak" data-val="trend5up">Trend 5D Up</a>
                            </li>
                            <li><a class="dropdown-item small" href="#" data-filter="streak" data-val="trend10up">Trend 10D Up</a>
                            </li>
                            <li><a class="dropdown-item small" href="#" data-filter="streak" data-val="trend20up">Trend 20D Up</a>
                            </li>
                        </ul>
                    </div>
                    <!-- Z-Score Relation Filters -->
                    <div class="dropdown hide-mobile">
                        <button class="btn btn-sm btn-outline-secondary dropdown-toggle px-2" type="button"
                            data-bs-toggle="dropdown" id="dd-zeffort">
                            Z-Effort: Any
                        </button>
                        <ul class="dropdown-menu dropdown-menu-sm">
                            <li><a class="dropdown-item small" href="#" data-filter="zeffort" data-val="any">Any</a></li>
                            <li><a class="dropdown-item small" href="#" data-filter="zeffort" data-val="2gt5">2D &gt; 5D</a></li>
                            <li><a class="dropdown-item small" href="#" data-filter="zeffort" data-val="2gt10">2D &gt; 10D</a></li>
                            <li><a class="dropdown-item small" href="#" data-filter="zeffort" data-val="2gt20">2D &gt; 20D</a></li>
                            <li><a class="dropdown-item small" href="#" data-filter="zeffort" data-val="5gt10">5D &gt; 10D</a></li>
                            <li><a class="dropdown-item small" href="#" data-filter="zeffort" data-val="5gt20">5D &gt; 20D</a></li>
                            <li><a class="dropdown-item small" href="#" data-filter="zeffort" data-val="10gt20">10D &gt; 20D</a></li>
                            <li><a class="dropdown-item small" href="#" data-filter="zeffort" data-val="ladderUp">2D ≥ 5D ≥ 10D ≥ 20D</a></li>
                        </ul>
                    </div>
                    <div class="dropdown hide-mobile">
                        <button class="btn btn-sm btn-outline-secondary dropdown-toggle px-2" type="button"
                            data-bs-toggle="dropdown" id="dd-zngr">
                            Z-NGR: Any
                        </button>
                        <ul class="dropdown-menu dropdown-menu-sm">
                            <li><a class="dropdown-item small" href="#" data-filter="zngr" data-val="any">Any</a></li>
                            <li><a class="dropdown-item small" href="#" data-filter="zngr" data-val="2gt5">2D &gt; 5D</a></li>
                            <li><a class="dropdown-item small" href="#" data-filter="zngr" data-val="2gt10">2D &gt; 10D</a></li>
                            <li><a class="dropdown-item small" href="#" data-filter="zngr" data-val="2gt20">2D &gt; 20D</a></li>
                            <li><a class="dropdown-item small" href="#" data-filter="zngr" data-val="5gt10">5D &gt; 10D</a></li>
                            <li><a class="dropdown-item small" href="#" data-filter="zngr" data-val="5gt20">5D &gt; 20D</a></li>
                            <li><a class="dropdown-item small" href="#" data-filter="zngr" data-val="10gt20">10D &gt; 20D</a></li>
                            <li><a class="dropdown-item small" href="#" data-filter="zngr" data-val="ladderUp">2D ≥ 5D ≥ 10D ≥ 20D</a></li>
                        </ul>
                    </div>
                    <div class="dropdown hide-mobile">
                        <button class="btn btn-sm btn-outline-secondary dropdown-toggle px-2" type="button"
                            data-bs-toggle="dropdown" id="dd-zvwap">
                            Z-VWAP: Any
                        </button>
                        <ul class="dropdown-menu dropdown-menu-sm">
                            <li><a class="dropdown-item small" href="#" data-filter="zvwap" data-val="any">Any</a></li>
                            <li><a class="dropdown-item small" href="#" data-filter="zvwap" data-val="2gt5">2D &gt; 5D</a></li>
                            <li><a class="dropdown-item small" href="#" data-filter="zvwap" data-val="2gt10">2D &gt; 10D</a></li>
                            <li><a class="dropdown-item small" href="#" data-filter="zvwap" data-val="2gt20">2D &gt; 20D</a></li>
                            <li><a class="dropdown-item small" href="#" data-filter="zvwap" data-val="5gt10">5D &gt; 10D</a></li>
                            <li><a class="dropdown-item small" href="#" data-filter="zvwap" data-val="5gt20">5D &gt; 20D</a></li>
                            <li><a class="dropdown-item small" href="#" data-filter="zvwap" data-val="10gt20">10D &gt; 20D</a></li>
                            <li><a class="dropdown-item small" href="#" data-filter="zvwap" data-val="ladderUp">2D ≥ 5D ≥ 10D ≥ 20D</a></li>
                        </ul>
                    </div>
                    <!-- Effort -->
                    <div class="dropdown hide-mobile">
                        <button class="btn btn-sm btn-outline-secondary dropdown-toggle px-2" type="button"
                            data-bs-toggle="dropdown" id="dd-effort">
                            Effort: Any
                        </button>
                        <ul class="dropdown-menu dropdown-menu-sm">
                            <li><a class="dropdown-item small" href="#" data-filter="effort" data-val="any">Any</a></li>
                            <li><a class="dropdown-item small" href="#" data-filter="effort" data-val="high">High (z
                                    &gt; 1)</a></li>
                            <li><a class="dropdown-item small" href="#" data-filter="effort" data-val="positive">Positif
                                    (z &gt; 0)</a></li>
                        </ul>
                    </div>
                    <!-- State -->
                    <div class="dropdown">
                        <button class="btn btn-sm btn-outline-secondary dropdown-toggle px-2" type="button"
                            data-bs-toggle="dropdown" id="dd-state">
                            State: Any
                        </button>
                        <ul class="dropdown-menu dropdown-menu-sm">
                            <li><a class="dropdown-item small" href="#" data-filter="state" data-val="any">Any</a></li>
                            <li><a class="dropdown-item small" href="#" data-filter="state"
                                    data-val="accum">Accumulation</a></li>
                            <li><a class="dropdown-item small" href="#" data-filter="state"
                                    data-val="markup">Accumulation / Ready Markup</a></li>
                        </ul>
                    </div>
                    <!-- Horizon Selector -->
                    <div class="dropdown">
                        <button class="btn btn-sm btn-outline-info dropdown-toggle py-0 px-2" type="button"
                            data-bs-toggle="dropdown" id="dd-horizon">
                            Horizon: Any
                        </button>
                        <ul class="dropdown-menu dropdown-menu-sm">
                            <li><a class="dropdown-item small" href="#" data-filter="horizon" data-val="any">Any
                                    horizon</a></li>
                            <li><a class="dropdown-item small" href="#" data-filter="horizon" data-val="2">2D only</a>
                            </li>
                            <li><a class="dropdown-item small" href="#" data-filter="horizon" data-val="5">5D only</a>
                            </li>
                            <li><a class="dropdown-item small" href="#" data-filter="horizon" data-val="10">10D only</a>
                            </li>
                            <li><a class="dropdown-item small" href="#" data-filter="horizon" data-val="20">20D only</a>
                            </li>
                        </ul>
                    </div>
                    <!-- View Selector -->
                    <div class="dropdown ms-auto">
                        <button class="btn btn-sm btn-outline-secondary dropdown-toggle py-0 px-2" type="button"
                            data-bs-toggle="dropdown" id="dd-view">
                            <i class="fa-solid fa-eye me-1"></i>View
                        </button>
                        <div class="dropdown-menu dropdown-menu-end dropdown-menu-sm p-2" style="min-width: 190px;">
                            <label class="dropdown-item small d-flex align-items-center gap-2 mb-1">
                                <input type="checkbox" class="form-check-input m-0" data-view-horizon="2" checked>
                                <span>Show 2D columns</span>
                            </label>
                            <label class="dropdown-item small d-flex align-items-center gap-2 mb-1">
                                <input type="checkbox" class="form-check-input m-0" data-view-horizon="5" checked>
                                <span>Show 5D columns</span>
                            </label>
                            <label class="dropdown-item small d-flex align-items-center gap-2 mb-1">
                                <input type="checkbox" class="form-check-input m-0" data-view-horizon="10" checked>
                                <span>Show 10D columns</span>
                            </label>
                            <label class="dropdown-item small d-flex align-items-center gap-2">
                                <input type="checkbox" class="form-check-input m-0" data-view-horizon="20" checked>
                                <span>Show 20D columns</span>
                            </label>
                        </div>
                    </div>
                </div>
                <!-- Row 3: Active filter pills -->
                <div id="active-pills" class="d-flex flex-wrap gap-1 mb-1 border-top" style="min-height:0;"></div>
            </div>
            <div class="card card-swing">
                <div class="table-responsive">
                    <table class="table table-hover mb-0 table-orderflow align-middle">
                        <thead>
                            <tr>
                                <th class="text-center">#</th>
                                <th data-sort="symbol" style="cursor:pointer">Emiten <i
                                        class="fa-solid fa-sort small text-muted"></i></th>
                                <th class="text-center col-h2" data-sort="sm2" style="cursor:pointer">2D <i
                                        class="fa-solid fa-sort small text-muted"></i></th>
                                <th class="text-center col-h5" data-sort="sm5" style="cursor:pointer">5D <i
                                        class="fa-solid fa-sort small text-muted"></i></th>
                                <th class="text-center hide-mobile col-h10" data-sort="sm10" style="cursor:pointer">10D <i
                                        class="fa-solid fa-sort small text-muted"></i></th>
                                <th class="text-center hide-mobile col-h20" data-sort="sm20" style="cursor:pointer">20D <i
                                        class="fa-solid fa-sort small text-muted"></i></th>
                                <th class="text-center hide-mobile col-h2" data-sort="vwap2" style="cursor:pointer">V-WAP 2D <i
                                        class="fa-solid fa-sort small text-muted"></i></th>
                                <th class="text-center hide-mobile col-h5" data-sort="vwap5" style="cursor:pointer">V-WAP 5D <i
                                        class="fa-solid fa-sort small text-muted"></i></th>
                                <th class="text-center hide-mobile col-h10" data-sort="vwap10" style="cursor:pointer">V-WAP 10D <i
                                        class="fa-solid fa-sort small text-muted"></i></th>
                                <th class="text-center hide-mobile col-h20" data-sort="vwap20" style="cursor:pointer">V-WAP 20D <i
                                        class="fa-solid fa-sort small text-muted"></i></th>
                                <th class="text-center col-h2" data-sort="flow2" style="cursor:pointer">Flow 2D <i
                                        class="fa-solid fa-sort small text-muted"></i></th>
                                <th class="text-center col-h5" data-sort="flow5" style="cursor:pointer">Flow 5D <i
                                        class="fa-solid fa-sort small text-muted"></i></th>
                                <th class="text-center hide-mobile col-h10" data-sort="flow10" style="cursor:pointer">Flow 10D <i
                                        class="fa-solid fa-sort small text-muted"></i></th>
                                <th class="text-center hide-mobile col-h20" data-sort="flow20" style="cursor:pointer">Flow 20D <i
                                        class="fa-solid fa-sort small text-muted"></i></th>
                                <th class="text-center col-h2" data-sort="effort2" style="cursor:pointer">Eff 2D <i
                                        class="fa-solid fa-sort small text-muted"></i></th>
                                <th class="text-center col-h5" data-sort="effort5" style="cursor:pointer">Eff 5D <i
                                        class="fa-solid fa-sort small text-muted"></i></th>
                                <th class="text-center hide-mobile col-h10" data-sort="effort10" style="cursor:pointer">Eff 10D <i
                                        class="fa-solid fa-sort small text-muted"></i></th>
                                <th class="text-center hide-mobile col-h20" data-sort="effort20" style="cursor:pointer">Eff 20D <i
                                        class="fa-solid fa-sort small text-muted"></i></th>
                                <th class="text-center" data-sort="state" style="cursor:pointer">State <i
                                        class="fa-solid fa-sort small text-muted"></i></th>
                            </tr>
                        </thead>
                        <tbody id="tbody-index">
                            <!-- Populated by JS -->
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- PAGINATION -->
            <nav id="pagination-nav" class="d-flex justify-content-between align-items-center my-3">
                <div class="text-muted small">
                    Showing <span id="page-range">1-100</span> of <span id="total-items">0</span>
                </div>
                <ul class="pagination pagination-sm mb-0">
                    <li class="page-item" id="prev-page">
                        <a class="page-link" href="#" onclick="changeScreenerPage(-1); return false;">«</a>
                    </li>
                    <li class="page-item active">
                        <span class="page-link" id="current-page-num">1</span>
                    </li>
                    <li class="page-item disabled">
                        <span class="page-link" id="total-pages">/ 1</span>
                    </li>
                    <li class="page-item" id="next-page">
                        <a class="page-link" href="#" onclick="changeScreenerPage(1); return false;">»</a>
                    </li>
                </ul>
            </nav>
        </div>

        <!-- VIEW 2: DETAIL DASHBOARD -->
        <div id="detail-view" style="display:none;">

            <!-- TABS -->
            <ul class="nav nav-tabs mb-3 mt-3" id="detailTabs" role="tablist">
                <li class="nav-item" role="presentation">
                    <a class="nav-link" id="intraday-link" href="#">Intraday</a>
                </li>
                <li class="nav-item" role="presentation">
                    <button class="nav-link active" id="summary-tab" data-bs-toggle="tab" data-bs-target="#summary-pane"
                        type="button" role="tab">Fund Flow</button>
                </li>
                <li class="nav-item" role="presentation">
                    <button class="nav-link" id="audit-tab" data-bs-toggle="tab" data-bs-target="#audit-pane"
                        type="button" role="tab">Audit Trail</button>
                </li>
            </ul>

            <!-- AI Analytics Button -->
            <div id="ai-analytics-bar" class="d-flex justify-content-center mb-2" style="display:none !important;">
                <button id="btn-ai-analyze" class="btn btn-sm btn-outline-primary" onclick="runAIAnalysis()">
                    <i class="fa-solid fa-wand-magic-sparkles me-1"></i> AI Analysis
                </button>
            </div>

            <!-- AI Result Modal (centered) -->
            <div class="modal fade" id="aiResultModal" tabindex="-1">
                <div class="modal-dialog modal-lg modal-dialog-centered modal-dialog-scrollable">
                    <div class="modal-content">
                        <div class="modal-header py-2">
                            <h6 class="modal-title">AI Broker Flow Analysis —
                                <span id="ai-modal-symbol"></span>
                            </h6>
                            <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                        </div>
                        <div class="modal-body" id="ai-result-body">
                            <!-- Thumbnail strip -->
                            <div id="ai-thumbnails" class="d-flex gap-2 flex-wrap mb-3 p-2 bg-light rounded"
                                style="display:none !important;"></div>
                            <!-- Analysis content -->
                            <div id="ai-analysis-content">
                                <div class="text-center py-5">
                                    <div class="spinner-border text-warning" role="status"></div>
                                    <p class="small text-muted mt-2">Menganalisis screenshot dengan AI...</p>
                                </div>
                            </div>
                        </div>
                        <div class="modal-footer py-1">
                            <small class="text-muted me-auto" id="ai-token-info"></small>
                            <button type="button" class="btn btn-sm btn-outline-warning" id="btn-ai-refresh"
                                style="display:none;" onclick="runAIAnalysis(true)">
                                <i class="fa-solid fa-rotate-right me-1"></i> Refresh
                            </button>
                            <button type="button" class="btn btn-sm btn-secondary"
                                data-bs-dismiss="modal">Tutup</button>
                        </div>
                    </div>
                </div>
            </div>

            <div class="tab-content" id="detailTabContent">
                <!-- TAB: SUMMARY -->
                <div class="tab-pane fade show active" id="summary-pane" role="tabpanel">
                    <!-- CHART -->
                    <div class="mb-1">
                        <div class="d-flex justify-content-between align-items-center mb-1 px-1">
                            <div class="d-flex align-items-center gap-2 flex-wrap legend-group">
                                <span class="legend-swatch legend-foreign">━ Foreign</span>
                                <span class="legend-swatch legend-retail">━ Retail</span>
                                <span class="legend-swatch legend-local">━ Local</span>
                                <span class="legend-swatch legend-institution">▮ Inst</span>
                                <span class="legend-swatch legend-retail-fill">▮ Retail</span>
                                <span class="legend-swatch legend-price">- - Price</span>
                            </div>
                            <small class="text-muted" style="font-size:0.75rem;">line: cumulative, bar: daily
                                net</small>
                        </div>
                        <div class="chart-container-responsive">
                            <canvas id="detailChart"></canvas>
                        </div>
                    </div>

                    <!-- PROPORTIONAL BAR (Foreign / Local / Retail) -->
                    <div id="proportional-bar-container" class="mb-3"></div>

                    <!-- Z-SCORE FEATURES CARD -->
                    <div id="zscore-features-card" class="card card-swing mb-3">
                        <div class="card-body py-2">
                            <div class="row g-2 text-center">
                                <div class="col py-2">
                                    <div class="small text-white">Effort</div>
                                    <div id="feat-effort" class="fw-bold">-</div>
                                </div>
                                <div class="col py-2">
                                    <div class="small text-white">Price Response</div>
                                    <div id="feat-response" class="fw-bold">-</div>
                                </div>
                                <div class="col py-2">
                                    <div class="small text-white">Net Quality</div>
                                    <div id="feat-quality" class="fw-bold">-</div>
                                </div>
                                <div class="col py-2">
                                    <div class="small text-white">VWAP</div>
                                    <div id="feat-vwap" class="fw-bold">-</div>
                                </div>
                                <div class="col py-2">
                                    <div class="small text-white">Elasticity</div>
                                    <div id="feat-elasticity" class="fw-bold">-</div>
                                </div>
                                <div class="col py-2">
                                    <div class="small text-white">State</div>
                                    <div id="feat-state" class="fw-bold">-</div>
                                </div>
                    </div>
      </div>
  </div>

                    <!-- HORIZON METRICS CARD -->
                    <div id="horizon-metrics-card" class="card card-swing mb-3 d-none">
                        <div class="card-body py-2">
                            <div class="table-responsive">
                                <table class="table table-sm table-orderflow table-borderless mb-0 align-middle">
                                    <thead>
                                        <tr>
                                            <th></th>
                                            <th class="text-center">2D</th>
                                            <th class="text-center">5D</th>
                                            <th class="text-center">10D</th>
                                            <th class="text-center">20D</th>
                                        </tr>
                                    </thead>
                                    <tbody id="horizon-metrics-tbody">
                                        <tr>
                                            <td class="text-muted small" colspan="5">No data</td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>

  <!-- BROKER TABLE -->
  <div class="card card-swing mb-4">
      <div class="card-header bg-white border-bottom-0 py-3">

                            <!-- Top Row: Legend Centered -->
                            <!-- Top Row: Legend Removed per user request -->
                            <div class="text-center small mb-2 pb-2 d-none">
                                <span class="fw-bold text-success me-2">● Foreign Fund</span>
                                <span class="fw-bold text-danger me-2">● Retail</span>
                                <span class="fw-bold text-primary">● Local Fund</span>
                            </div>

                            <!-- Bottom Row: Controls -->
                            <div class="d-flex justify-content-between align-items-center">
                                <!-- Dates Group + Apply (Left) -->
                                <div class="d-flex gap-2 align-items-center">
                                    <div class="d-flex gap-1">
                                        <input type="date" id="date-from" class="form-control form-control-sm"
                                            style="max-width: 130px;" />
                                        <input type="date" id="date-to" class="form-control form-control-sm"
                                            style="max-width: 130px;" />
                                    </div>
                                    <button id="btn-apply-range" class="btn btn-sm btn-primary">Apply</button>
                                </div>

                                <!-- Action Group (Right) - Net Only -->
                                <div>
                                    <div class="form-check form-switch mb-0 d-flex align-items-center gap-1 ms-1">
                                        <input class="form-check-input my-0" type="checkbox" id="toggleNet" checked>
                                        <label class="form-check-label small mb-0" for="toggleNet">Net</label>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="card-body" id="broker-table-container">
                            <p class="text-muted small">Detail metrics will appear here based on R2 data.</p>
                        </div>
                    </div>
                </div>

                <!-- TAB: AUDIT TRAIL -->
                <div class="tab-pane fade" id="audit-pane" role="tabpanel">
                    <div class="card card-swing">
                        <div class="card-body">
                            <div id="audit-trail-list">
                                <p class="text-muted small">Click to load audit trail...</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

    </div>

    <!-- SCRIPTS -->
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-datalabels@2.2.0"></script>
    <script src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js"></script>
    <script src="component.js"></script>

    <script>
        (function () {
            const params = new URLSearchParams(window.location.search);
            if (params.has('kode')) {
                const icon = document.getElementById('theme-toggle-icon');
                if (icon) {
                    icon.classList.add('d-none');
                }
            }
        })();
    </script>

    <!-- MAIN APP LOGIC -->
    <script src="broker-summary.js?v=36"></script>
</body>

</html>
