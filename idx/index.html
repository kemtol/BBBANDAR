<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="theme-color" content="#0b0b0e">

    <script>
        (function () {
            const STORAGE_KEY = 'ui:theme';
            const root = document.documentElement;
            try {
                const saved = window.localStorage ? localStorage.getItem(STORAGE_KEY) : null;
                const theme = saved || 'dark';
                root.setAttribute('data-theme', theme);
                root.style.colorScheme = theme === 'dark' ? 'dark' : 'light';
            } catch (error) {
                root.setAttribute('data-theme', 'dark');
                root.style.colorScheme = 'dark';
            }
        })();
    </script>

    <title>SSSAHAM - Dashboard</title>

    <link rel="apple-touch-icon" sizes="180x180" href="img/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="img/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="img/favicon-16x16.png">

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.7.2/css/all.min.css" rel="stylesheet">
    <link rel="stylesheet" href="../theme.css">
    <link href="css/styles.css" rel="stylesheet">

    <script>
        // ========================================
        // DEV_MODE: Set to true to skip auth guard
        // ========================================
        const DEV_MODE = true;

        // Auth Guard: Check if token exists
        if (!DEV_MODE) {
            const token = localStorage.getItem("qqquanta_token");
            if (!token) {
                window.location.href = "login.html";
            }
        }
    </script>
</head>

<body>

    <!-- NAVBAR -->
    <nav class="navbar sticky-top py-3">
        <div class="container d-flex align-items-center" style="max-width: 1440px;position: relative;">
            <a href="https://buy.sssaham.com" id="nav-back" class="d-flex align-items-center text-decoration-none me-2">
                <i class="fa-solid fa-chevron-left me-1"></i>
                <span class="small d-none">Bandar Radar</span>
            </a>
            <div class="flex-grow-1 text-center">
                <span class="nav-title" id="header-title">Dashboard</span>
            </div>
            <div style="width:72px;" class="text-end">
                <i class="fa-solid fa-magnifying-glass" style="cursor: pointer;" onclick="toggleSearch()"></i>
            </div>
        </div>
    </nav>

    <div id="search-panel">
        <div class="mb-4">
            <input type="text" id="search-input" class="search-input" placeholder="Masukkan Kode (e.g. BBRI)"
                autocomplete="off">
        </div>

        <div>
            <p class="small opacity-75 mb-2 fw-bold">RIWAYAT PENCARIAN</p>
            <div id="search-history-list">
                <!-- Populated by JS -->
            </div>
        </div>
    </div>

    <div id="loading-indicator" class="text-center my-5">
        <div class="spinner-border text-primary" role="status">
            <span class="visually-hidden">Loading...</span>
        </div>
        <p class="small text-muted mt-2">Memuat data...</p>
    </div>

    <div id="app" class="container" style="display:none;">
        <!-- VIEW 1: INDEX (DAFTAR EMITEN) -->
        <div id="index-view">
            <!-- DASHBOARD TABS -->
            <ul class="nav nav-tabs mb-3" role="tablist">
                <li class="nav-item" role="presentation">
                    <a class="nav-link active" href="#">Feed</a>
                </li>
                <li class="nav-item" role="presentation">
                    <a class="nav-link" href="emiten/index.html">Orderflow</a>
                </li>
                <li class="nav-item" role="presentation">
                    <a class="nav-link" href="emiten/broker-summary.html">Brokerflow</a>
                </li>
            </ul>
        </div>

        <!-- Filter Section -->
        <section id="filters" class="filter-section mb-4 d-none">
            <div class="container ps-0">
                <div class="filter-scroll">
                    <div class="filter-icon">
                        <i class="fa-solid fa-sliders text-secondary small"></i>
                        <span class="filter-divider"></span>
                    </div>
                    <button class="filter-pill active">All</button>
                    <button class="filter-pill">Nasdaq</button>
                    <button class="filter-pill">S&P500</button>
                    <button class="filter-pill">Gold</button>
                    <button class="filter-pill">BTC Futures</button>
                    <button class="filter-pill">EUR/USD</button>
                    <button class="filter-pill">GBP/USD</button>
                    <button class="filter-pill">USD/JPY</button>
                </div>
            </div>
        </section>

        <section id="content" class="content-section mt-0 pt-0">
            <div class="container ps-0">
                <div class="row">
                    <!-- Feed Section (Left) -->
                    <div class="col-md-6 mb-4">
                        <strong class="text-dark mb-3 d-block text-center ">Feed</strong>
                        <div class="timeline timeline-right">
                            <div class="timeline-line"></div>

                            <!-- Latest Item (Top) -->
                            <div class="timeline-item">
                                <div class="timeline-dot primary"></div>
                                <div class="timeline-time">2 minutes ago</div>
                                <div class="timeline-card">
                                    <div class="timeline-title primary">QQQUANTA AI</div>
                                    <p class="timeline-text">
                                        üöÄ <strong>ES Futures</strong> showing bullish divergence on footprint. High
                                        volume
                                        at 5250
                                        support level. Watch for breakout above 5265.
                                    </p>
                                    <div class="timeline-tags">
                                        <span>#Futures</span>
                                        <span class="tag-hot">#Hot</span>
                                    </div>
                                </div>
                            </div>

                            <div class="timeline-item">
                                <div class="timeline-dot warning"></div>
                                <div class="timeline-time">15 minutes ago</div>
                                <div class="timeline-card">
                                    <div class="timeline-title warning">Crypto Alert</div>
                                    <p class="timeline-text">
                                        üìä <strong>BTC/USDT</strong> large buy imbalance detected at $42,500. Delta
                                        positive
                                        on 15m
                                        timeframe. Potential long opportunity.
                                    </p>
                                    <div class="timeline-tags">
                                        <span>#Crypto</span>
                                        <span class="tag-bullish">#Bullish</span>
                                    </div>
                                </div>
                            </div>

                            <div class="timeline-item">
                                <div class="timeline-dot success"></div>
                                <div class="timeline-time">1 hour ago</div>
                                <div class="timeline-card">
                                    <div class="timeline-title success">AI Sentiment</div>
                                    <p class="timeline-text">
                                        ü§ñ Daily sentiment analysis complete. <strong>NQ</strong> sentiment: 72%
                                        bullish.
                                        <strong>CL</strong> sentiment: 58% bearish. Full report available in AI
                                        Analytics.
                                    </p>
                                    <div class="timeline-tags">
                                        <span>#AI</span>
                                        <span>#Daily</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Catalyst Section (Right) -->
                    <div class="col-md-6 mb-4">
                        <strong class="text-dark mb-3 text-center d-block ">Catalyst</strong>
                        <div class="timeline">
                            <div class="timeline-line"></div>

                            <!-- Nearest Upcoming (Top) -->
                            <div class="timeline-item">
                                <div class="timeline-dot" style="background: #3b82f6;"></div>
                                <div class="timeline-time">In 30 minutes</div>
                                <div class="timeline-card" style="background: #eff6ff;">
                                    <div class="timeline-title" style="color: #3b82f6;">FOMC Member Speaks</div>
                                    <p class="timeline-text">
                                        üó£Ô∏è <strong>Bowman</strong> speaking at 10:00 AM EST. Watch for comments on
                                        interest
                                        rate path.
                                    </p>
                                    <div class="timeline-tags">
                                        <span>#Macro</span>
                                        <span>#USD</span>
                                    </div>
                                </div>
                            </div>

                            <div class="timeline-item upcoming">
                                <div class="timeline-dot" style="background: #ef4444;"></div>
                                <div class="timeline-time">In 4 hours</div>
                                <div class="timeline-card" style="background: #fef2f2;">
                                    <div class="timeline-title" style="color: #ef4444;">CPI Data Release</div>
                                    <p class="timeline-text">
                                        üá∫üá∏ <strong>US CPI</strong> YoY Forecast: 3.1%. Previous: 3.2%. High impact on
                                        USD
                                        pairs and Gold.
                                    </p>
                                    <div class="timeline-tags">
                                        <span>#Forex</span>
                                        <span style="color: #ef4444;">#HighImpact</span>
                                    </div>
                                </div>
                            </div>

                            <!-- Furthest Future (Bottom) -->
                            <div class="timeline-item upcoming">
                                <div class="timeline-dot" style="background: #8b5cf6;"></div>
                                <div class="timeline-time">Tomorrow, 08:30 AM</div>
                                <div class="timeline-card" style="background: #fdf4ff;">
                                    <div class="timeline-title" style="color: #8b5cf6;">Unlock: Token XYZ</div>
                                    <p class="timeline-text">
                                        üîì <strong>XYZ</strong> token unlock of 50M tokens (approx. $10M) occurring
                                        tomorrow.
                                        Expect potential volatility.
                                    </p>
                                    <div class="timeline-tags">
                                        <span>#Crypto</span>
                                        <span>#Unlock</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>
    </div>

    <!-- Init Script to Simulate Loading -->
    <script>
        document.addEventListener("DOMContentLoaded", () => {
            // Slight delay to smoother transition or immediate
            setTimeout(() => {
                const loader = document.getElementById("loading-indicator");
                const app = document.getElementById("app");
                if (loader) loader.style.display = "none";
                if (app) app.style.display = "block";
            }, 500); // 500ms delay for visual feedback
        });
    </script>

    <script>
        // Page specific logic updates
        const userStr = localStorage.getItem("qqquanta_user");
        if (userStr) {
            try {
                const user = JSON.parse(userStr);
                // Update Header Name
                const userNameEl = document.getElementById("user-name");
                if (userNameEl) userNameEl.textContent = user.name || "User";

                // Update Page Details
                const details = document.getElementById("user-details");
                if (details) {
                    details.innerHTML = `
                    ${user.picture ? `<img src="${user.picture}" alt="Profile">` : ''}
                    <div>
                        <h5 class="mb-1">${user.name}</h5>
                        <p class="mb-0 text-muted">${user.email}</p>
                    </div>
                `;
                }
            } catch (e) { console.error(e); }
        } else {
            // DEV_MODE: Show placeholder
            const details = document.getElementById("user-details");
            if (details) {
                details.innerHTML = `
                <img src="https://via.placeholder.com/64" alt="Profile">
                <div>
                    <h5 class="mb-1">Dev User</h5>
                    <p class="mb-0 text-muted">dev@qqquanta.com</p>
                </div>
            `;
            }
            const userNameEl = document.getElementById("user-name");
            if (userNameEl) userNameEl.textContent = "Dev User";
        }

        function logout() {
            if (confirm("Are you sure you want to logout?")) {
                localStorage.removeItem("qqquanta_token");
                localStorage.removeItem("qqquanta_user");
                window.location.href = "login.html";
            }
        }

        function toggleMobileMenu() {
            // TODO: Implement mobile menu
            alert("Mobile menu coming soon!");
        }

        // Trading Hours Clock Logic
        const tradingSessions = {
            tokyo: { open: 9, close: 15, tz: 'Asia/Tokyo' },
            london: { open: 8, close: 16, tz: 'Europe/London' },
            newyork: { open: 9, close: 16, tz: 'America/New_York' }
        };

        function getTimeInTimezone(tz) {
            const now = new Date();
            const options = { timeZone: tz, hour: '2-digit', minute: '2-digit', hour12: false };
            const timeStr = now.toLocaleTimeString('en-GB', options);
            const [hours, minutes] = timeStr.split(':').map(Number);
            return { hours, minutes, timeStr };
        }

        function isMarketOpen(session, hours) {
            // Check if weekday (Mon-Fri)
            const now = new Date();
            const dayOptions = { timeZone: session.tz, weekday: 'short' };
            const day = now.toLocaleDateString('en-US', dayOptions);
            const isWeekday = !['Sat', 'Sun'].includes(day);

            return isWeekday && hours >= session.open && hours < session.close;
        }

        function updateClocks() {
            Object.keys(tradingSessions).forEach(city => {
                const session = tradingSessions[city];
                const { hours, minutes, timeStr } = getTimeInTimezone(session.tz);

                // Update time display
                document.getElementById(`${city}-time`).textContent = timeStr;

                // Update clock hands
                const hourDeg = (hours % 12) * 30 + minutes * 0.5;
                const minuteDeg = minutes * 6;

                document.getElementById(`${city}-hour`).style.transform = `rotate(${hourDeg}deg)`;
                document.getElementById(`${city}-minute`).style.transform = `rotate(${minuteDeg}deg)`;

                // Update market status
                const statusEl = document.getElementById(`${city}-status`);
                const isOpen = isMarketOpen(session, hours);
                statusEl.textContent = isOpen ? 'OPEN' : 'CLOSED';
                statusEl.className = `clock-status ${isOpen ? 'open' : 'closed'}`;

                // Update Wrapper Opacity
                const wrapper = document.getElementById(`clock-wrapper-${city}`);
                if (wrapper) {
                    wrapper.style.opacity = isOpen ? '1' : '0.7';
                }
            });
        }

        // Initial update and set interval
        updateClocks();
        setInterval(updateClocks, 1000);
    </script>

    <!-- SCRIPTS -->
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="emiten/component.js"></script>
</body>

</html>
