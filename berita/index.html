<!doctype html>
<html lang="id">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <meta name="theme-color" content="#ffffff">
  <link rel="manifest" href="/site.webmanifest">
  <title>Berita — BBBANDAR</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.7.2/css/all.min.css" rel="stylesheet">
  <link rel="stylesheet" href="/style.css?v=1.4">
</head>
<body>
  <div class="container my-4">
    <a href="/" class="d-inline-block mb-3" style="text-decoration:none;color:var(--primary);">← Kembali ke Beranda</a>

    <h1 class="mb-4">Berita & Analisis</h1>

    <div id="berita-list">
      <div id="berita-loading" class="text-center py-4 text-muted">Memuat daftar artikel…</div>
      <ul id="berita-items" class="list-unstyled" style="display:none"></ul>
    </div>

    <div class="text-center mt-4">
      <span class="text-muted">Menampilkan semua artikel di folder /berita/</span>
    </div>

  </div>

  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
  <script src="/script.js?v=1.5"></script>
  <script>
    // Client-side indexer: loads /berita/list.json, fetches each article file,
    // extracts the first <h1> and first <p> as an excerpt, then renders a list.
    // This keeps everything purely static — no Node needed. Uses jQuery as requested.
    (function($){
      var manifestUrl = '/berita/list.json';

      function safeText(el){ return (el && el.text()) ? el.text().trim() : ''; }

      $.getJSON(manifestUrl).done(function(list){
        if(!Array.isArray(list) || list.length===0){
          $('#berita-loading').text('Tidak ada artikel.');
          return;
        }

        var $items = $('#berita-items');
        var remaining = list.length;

        list.forEach(function(fname){
          var url = '/berita/' + fname;
          // Fetch the article file (same-origin)
          $.get(url).done(function(data){
            // Parse returned HTML and extract the first h1 and first paragraph
            var $wrap = $('<div>').append($.parseHTML(data));
            var title = safeText($wrap.find('h1').first()) || fname;
            var excerpt = safeText($wrap.find('p').first()) || '';

            var $li = $('<li>').addClass('mb-3');
            var $a = $('<a>').attr('href', url).addClass('text-decoration-none');
            $a.append($('<strong>').text(title));
            if(excerpt) $a.append($('<div>').addClass('text-muted small').text(excerpt));
            $li.append($a);
            $items.append($li);
          }).fail(function(){
            // If fetch fails, still create a link so user can try
            var $li = $('<li>').addClass('mb-3');
            var $a = $('<a>').attr('href', url).addClass('text-decoration-none');
            $a.append($('<strong>').text(fname));
            $li.append($a);
            $items.append($li);
          }).always(function(){
            remaining -= 1;
            if(remaining<=0){
              $('#berita-loading').hide();
              $items.show();
            }
          });
        });
      }).fail(function(){
        $('#berita-loading').text('Gagal memuat daftar (/berita/list.json tidak ditemukan).');
      });
    })(jQuery);
  </script>
</body>
</html>