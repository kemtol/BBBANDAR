<!DOCTYPE html>
<html lang="id">

<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<meta name="theme-color" content="#ffffff" />
	<link rel="manifest" href="manifest.json">
	<link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
	<link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
	<link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
	<link rel="manifest" href="/site.webmanifest">
	<!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
	<link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.7.2/css/all.min.css" rel="stylesheet">
	<title>BBBANDAR SSSAHAM - Bandar Saham Kolektif Untuk Para Ritel Saham</title>
	<style>
	body {
		background-color: darkslategray;
	}
	
	section{
		background: transparent;
	}
	


	#app.container {
		max-width: 460px;
		width: 100%;
		margin: auto;
	}

	#splash-page, #login-page{
		display: flex;
		align-items: center;      /* vertikal center */
		justify-content: center;  /* horizontal center */
		width: 100%;
		height: 100vh;            /* tinggi = tinggi layar */
		margin: 0;
		padding: 0;
		overflow: hidden;
	}

	#home-page > .this-page{
		background: gainsboro;
		border-radius: 15px;
	}

	#splash-logo{
		border: 10px solid gold;
		border-radius: 50%;
		max-width: 15%;
	}

	.bg-overlay {
		position: absolute;
		inset: 0;
		z-index: 1;

		background-image:
			linear-gradient(rgba(75, 0, 130, 0.4), rgba(75, 0, 130, 0.4)),
			url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQIW2P8z/C/HwAF/wI/5lD6GQAAAABJRU5ErkJggg=='),
			url('splash-screen.jpg');
		background-size:
			cover,        /* 1) ungu */
			1000px 1000px,/* 2) noise tile */
			initial;        /* 3) foto */
		background-repeat:
			no-repeat,
			repeat,
			no-repeat;
		background-position:
			center,
			center,
			center;
		background-blend-mode:
			normal,
			overlay,
			normal;
		filter: brightness(0.3);
	}

	.bg-overlay::after {
		content: "";
		position: absolute;
		inset: 0;
		z-index: 2;
		pointer-events: none;

		/* hanya satu background di pseudo-element */
		background-image: 
			url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAwAAAAMCAIAAADZF8uwAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAANxJREFUeNpi/P//PwMlgImBQjDwH4j8GDAwMDAwT+T8jQxA0j+z8wMDAwPDfzPxkYGJi+P//P5hYGBgYGAD4z8TJQECDAwMDCw4GJgYGBkbGbIwMzAwIMfjP4z8YGhgeH+z8wMDAwPDfzPxgYGBlZEbGRgYGBgZGHjwMMDAwMHgwMTExMDgwMDAyMmJiYgIJGkDMDAwMjJmZGBgYGBjYwMDAzMzMzMTAwMDAwMDAwMDACDAwMDCwf/v37/BwYGhgaEhlcAAAwAAB1TjMh+Bt1NgAAAABJRU5ErkJggg==');
		background-repeat: repeat;
		background-size: 100px 100px;  /* ukuran noise tile pseudo */
		mix-blend-mode: overlay;
		opacity: 0.75;                  /* sesuaikan untuk intensitas */
	}


    #emiten-list a {
        text-decoration: none;
        color: #fff;
        font-weight: bold;
		background-color: dodgerblue;
        border-radius: 6px;
		width: 30%;
		border-top: 0px;
		border-left: 0px;
    }
        #emiten-list a:hover {
            color: #fff;
        }
	
	.emiten-info{
		background-color: white;
	}

	@media (max-width: 960px) {
		#splash-logo{
			max-width: 30%;
		}

		/* Buat semua .form-control memenuhi lebar container */
		#login-form {
			width: 100% !important;
			box-sizing: border-box; /* sertakan padding/ border ke dalam width */
		}

		/* Jika kamu pakai class .w-50 pada form, jadikan 100% di mobile */
		.this-page {
			width: 100% !important;
			max-width: 100% !important;
		}
	}

	#notif-container {
		position: fixed;
		bottom: 1rem;
		left: 1rem;
		display: flex;
		flex-direction: column;   /* notifikasi baru di bawah */
		gap: 0.5rem;
		pointer-events: none;
		z-index: 9999;
	}


	.notif {
		background-color:aliceblue;
		opacity: 0.8;
		color: #111;
		padding: 0.5rem 0.75rem;
		border-radius: 0.25rem;
		font-size: 0.85rem;
		white-space: nowrap;
		opacity: 0;
  /* slide in cepat, lalu tetap utuh ~8.7s, baru fade-out selama 0.3s */
		animation:
			slideIn 0.3s ease-out forwards,
			fadeOut 0.3s ease-in forwards 8.7s;
	}

	@keyframes slideIn {
	from {
		transform: translateY(10px);
		opacity: 0;
	}
	to {
		transform: translateY(0);
		opacity: 1;
	}
	}

	@keyframes fadeOut {
	to {
		opacity: 0;
	}
	}


	</style>
</head>

<body>
	<div id="app" class="container">
        <!-- halaman splash -->
		<section id="splash-page">
			<div class="bg-overlay"></div>
			<div class="this-page d-flex flex-column align-items-center p-4 my-4" style="position: relative;overflow: hidden;color: #fff;z-index:5">
				
				<h1 class="text-center" style="font-weight: 900;">SSSAHAM</h1>
				<img src="splash-logo.png" id="splash-logo" class="img-fluid my-4">
				<div id="manifesto">
				<!--<div id="manifesto" class="d-grid gap-3" style="grid-template-columns: repeat(2, 1fr);">-->
					<div class="border-bottom p-3">
						<p class="d-block text-center" style="font-family: georgia;">
							Satu Suara. Satu Aksi. Kolektif Melawan Oligarki. Dengan AI, open governance, dan transparansi.
						</p>
					</div>
					<div class=" p-3">
						<ol>
							<li>VOTE SAHAM secara Kolektif dari rekomendasi AI MALAM SEBELUMNYA.</li>
							<li>Masa blackout hasi voting antara pukul 21:00 - 09:05 keesokan harinya.</li>
							<li>Tepat 09:05 hasil voting saham akan  di berikan secara serentak</li>
							<li>BOOM VOLUME!</li>
						</ol>
					</div>
				</div>
				<button id="start-onboard" style="font-weight: 700;padding: 0.5rem 2rem;" class="btn btn-primary my-4">GABUNG PERGERAKAN</button>			</div>
        </section>

		<!-- halaman login -->
		<section id="login-page">
			<div class="this-page d-flex flex-column align-items-center p-4 my-4 w-100" style="position:relative;z-index:5">
				<h1 class="text-center mb-4 fw-900" style="color: #fff;">Login</h1>
				<span class="d-block mb-4 text-center" style="color: gainsboro;">Login kami straightforward hanya menggunakan OTP</span>
				<form id="login-form" class="w-75">
					<div class="mb-3">
						<label style="color:#fff;font-weight: 700;" for="Handphone" class="form-label">No Handphone</label>
						<input type="text" class="form-control" id="OTP" required> </div>
					<div class="mb-3">
						<label style="color:#fff;font-weight: 700;" for="OTP" class="form-label">OTP</label>
						<input type="OTP" class="form-control" id="OTP" required> </div>
					<button type="submit" class="btn btn-primary w-100">Login</button>
				</form>
			</div>
		</section>

		<!-- register page -->
		<section id="register-page">
			<div class="this-page d-flex flex-column align-items-center border-bottom p-4 my-4">
				<h1 class="text-center">Register</h1>
				<form id="register-form" class="w-50">
					<div class="mb-3">
						<label for="new-username" class="form-label">Username</label>
						<input type="text" class="form-control" id="new-username" required> </div>
					<div class="mb-3">
						<label for="new-password" class="form-label">Password</label>
						<input type="password" class="form-control" id="new-password" required> </div>
					<button type="submit" class="btn btn-primary">Register</button>
				</form>
			</div>
		</section>

		<!-- liveness -->
		<section id="liveness-check">
			<div class="this-page d-flex flex-column align-items-center p-4 my-4">
				<h1 class="text-center" style="color: white">Apakah Kamu Manusia</h1>
				<span style="color: white" class="d-block">Ikuti Instuksi</span>
				<div id="liveness-instruction" class="fs-4 my-3 text-center text-white"></div>
				<video id="liveness-preview" autoplay muted playsinline style="width: 100%; max-width: 400px; border-radius: 8px; background: #000;"></video>

				<div class="mt-3">
				<button id="start-record" class="btn btn-primary">Mulai Rekam</button>
				</div>

				<div id="liveness-result" class="mt-3 text-center"></div>
			</div>
		</section>

		<!-- halaman home -->
		<section id="home-page">
			<div class="this-page border-bottom d-flex flex-row align-items-center justify-content-between p-4 py-3 my-4">
				<h2 class="d-flex text-center fs-6" style="font-weight: 400;">👋 Selamat Datang Prajogo Pangestu</h2>
				<button id="d-flex logout-button" class="btn btn-lg p-0"><i class="fa-solid fa-power-off" style="color: dodgerblue;"></i></button>
			</div>
			<div>
				<p class="text-center" style="color: white;">Bagaimana colllective bandar bekerja?<br/> <a href="" style="color: dodgerblue;">Pelajari Lebih Lanjut</a></p>
			</div>
			<div class="this-page d-flex flex-column align-items-center border-bottom p-4 mb-4">
				<h1 class="text-center mb-3 fs-5 fw-bold">Kemungkinan saham yang besok naik</h1> 
				<span class="d-block mb-3">Klik untuk vote</span>
				<div id="emiten-list" class="w-100 d-flex flex-row align-items-center justify-content-center gap-2 mb-3    "> 
					<a class="btn btn-lg btn-outline-primary" href="">BRPT</a> 
					<a class="btn btn-lg btn-outline-primary" href="">BREN</a> 
					<a class="btn btn-lg btn-outline-primary" href="">CUAN</a> 
				</div>
				<!-- HTML countdown -->
				<div id="countdown" style="font-size: 3rem;" class="fw-bold text-primary mb-3"></div>
				<!-- END HTML countdown -->
				<span class="mb-3 d-block text-center">Hasil vote akan diumumkan besok jam 09:05 WIB <br /><span style="background-color: yellow;padding: 0px 2px;font-weight: 600;text-transform:uppercase;">secara serentak</span></span>
			</div>
			<div class="w-100 d-flex flex-grid align-items-center justify-content-center mb-4 gap-2">
				<div class="emiten-info p-4 w-25">
					<h2 class="text-center">BRPT</h2>
				</div>
				<div class="emiten-info p-4 w-25">
					<h2 class="text-center">BREN</h2>
				</div>
				<div class="emiten-info p-4 w-25">
					<h2 class="text-center">CUAN</h2>
				</div>	
			</div>
		</section>

		<!-- halaman error -->
		<section id="error-page">
			<div class="this-page d-flex flex-column align-items-center border-bottom p-4 my-4">
				<h1 class="text-center">Error</h1>
				<p class="text-center">An error occurred. Please try again later.</p>
			</div>
		</section>
	</div>

	<!-- notification container -->
	<div id="notif-container"></div>


    <!--------------------------------->
    <!-------- ALLL LOGIC HERE--------->
    <!--------------------------------->

	<!-- jQuery INIT -->
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
	<!-- Bootstrap Bundle JS INIT -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    
    <!-- jQuery in here -->
	<script>
	$(document).ready(function() {
		// ——————————————————————
		// 1) Fungsi navigasi & history
		// ——————————————————————
		function showPageNoHistory(id) {
			$('section').hide();
			$('#' + id).fadeIn();
		}

		function navigate(id) {
			if (location.hash !== '#' + id) {
			location.hash = id;  // push history
			} else {
			showPageNoHistory(id);
			}
		}

		$(window).on('hashchange', () => {
			const page = location.hash.slice(1);
			if ($('#' + page).length) showPageNoHistory(page);
		});

		// Inisialisasi halaman pertama
		const first = location.hash.slice(1);
		if (first && $('#' + first).length) {
			showPageNoHistory(first);
		} else {
			navigate('splash-page');
		}

		// Hook tombol navigasi
		$('#start-onboard').click(() => navigate('login-page'));
		$('#login-form button').click(e => {
			e.preventDefault();
			navigate('liveness-check');
		});
		$('#logout-button').click(() => navigate('login-page'));

		// ——————————————————————
		// 2) Liveness check
		// ——————————————————————
		let mediaStream, mediaRecorder, recordedChunks = [];

		async function initCamera() {
			try {
			mediaStream = await navigator.mediaDevices.getUserMedia({
				video: { facingMode: 'user' },
				audio: false
			});
			$('#liveness-preview')[0].srcObject = mediaStream;
			} catch (err) {
			$('#liveness-result').text('Gagal akses kamera: ' + err.message);
			}
		}

		function setupRecorder() {
			recordedChunks = [];
			mediaRecorder = new MediaRecorder(mediaStream, {
			mimeType: 'video/webm;codecs=vp8'
			});
			mediaRecorder.ondataavailable = e => {
			if (e.data.size) recordedChunks.push(e.data);
			};
			// ← pindahkan onstop ke sini
			mediaRecorder.onstop = async () => {
			$('#stop-record').prop('disabled', true);
			$('#start-record').prop('disabled', false);
			$('#liveness-result').text('Mengirim ke server…');

			const blob = new Blob(recordedChunks, { type: 'video/webm' });
			const form = new FormData();
			form.append('video', blob, 'liveness.webm');

			try {
				const res = await fetch('/api/liveness', { method: 'POST', body: form });
				const data = await res.json();
				$('#liveness-result').html(`Liveness score: <strong>${data.score}</strong>`);
			} catch (err) {
				$('#liveness-result').text('Gagal kirim: ' + err.message);
			}

			// setelah selesai, lanjut ke home
			navigate('home-page');
			};
		}

		$('#start-record').click(async function() {
			// 1) Pastikan kamera siap
			if (!mediaStream) await initCamera();
			setupRecorder();

			const instr = $('#liveness-instruction');
			const wait = ms => new Promise(r => setTimeout(r, ms));

			// 2) Hitung mundur 3–1
			for (let i = 3; i >= 1; i--) {
				instr.text(i);
				await wait(1000);
			}

			// 3) Mulai rekam
			recordedChunks = [];
			mediaRecorder.start();

			// 4) Tampilkan langkah-langkah:
			instr.text('Buka mulut');
			await wait(3000);

			instr.text('Tengok kanan');
			await wait(3000);

			instr.text('Tengok kiri');
			await wait(3000);

			// 5) Selesai → stop & kirim
			instr.text('Selesai');
			mediaRecorder.stop();

		// tombol dikendalikan di onstop
		});

		// jika langsung ke liveness page
		if (location.hash === '#liveness-check') {
			initCamera();
		}

		// ——————————————————————
		// 3) Countdown timer (tetap di luar pembacaan hash)
		// ——————————————————————
		(function startCountdown() {
			const now    = new Date();
			const offset = (7*60 + now.getTimezoneOffset()) * 60000;
			const jt     = new Date(now.getTime() + offset);
			const t      = new Date(jt.setDate(jt.getDate()+1));
			t.setHours(9,0,0,0);

			function upd() {
				const d = t - Date.now();
				if (d <= 0) return $('#countdown').text("Voting ditutup!");
				const h = String(Math.floor((d/36e5)%24)).padStart(2,'0');
				const m = String(Math.floor((d/6e4)%60)).padStart(2,'0');
				const s = String(Math.floor((d/1e3)%60)).padStart(2,'0');
				$('#countdown').text(`${h} : ${m} : ${s}`);
			}
		upd();
		setInterval(upd, 1000);
		})();

		// ——————————————————————
		// 4) Nootif stacking
		// ——————————————————————
		function showNotif(text) {
			const container = document.getElementById('notif-container');
			const el = document.createElement('div');
			el.className = 'notif';
			el.textContent = text;

			// 1) Tambah NOTIF di bawah
			container.appendChild(el);

			// 2) Kalau sudah >5, hapus notif paling atas (yang pertama)
			if (container.children.length > 5) {
				container.removeChild(container.firstElementChild);
			}

			// 3) Hapus elemen ini setelah 9 detik
			setTimeout(() => {
				if (container.contains(el)) {
				container.removeChild(el);
				}
			}, 9000);
			}

			// simulasi setiap 3 detik
			setInterval(() => {
			const phone = '08' + Math.floor(10000000 + Math.random()*90000000);
			const stocks = ['BRPT','BREN','CUAN','TLKM'];
			const stock = stocks[Math.floor(Math.random()*stocks.length)];
			showNotif(`${phone} vote ${stock}`);
			}, 3000);




	});
	</script>

    
    <!-- Service Worker Registration (ini nanti aja kalau udah mau jadi app) -->
	<script>
	// Register service worker
	/*if('serviceWorker' in navigator) {
		navigator.serviceWorker.register('sw.js').then(reg => console.log('Service Worker registered', reg)).catch(err => console.error('SW registration failed', err));
	}*/
	</script>
</body>

</html>